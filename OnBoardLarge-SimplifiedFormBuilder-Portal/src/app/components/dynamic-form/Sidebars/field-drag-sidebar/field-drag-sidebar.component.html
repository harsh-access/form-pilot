<div id="DragFieldSidebarCanvas"  class="offcanvas w-25 functional-side-panel font-open-sans offcanvas-{{ sidebarPosition }}"
  data-bs-scroll="true" data-bs-backdrop="static" data-bs-keyboard="false" aria-labelledby="DragFieldSidebarCanvasLabel">
   <div class="offcanvas-header text-gray-400 border-bottom p-0">
      <h4 *ngFor="let tab of ['Settings','Advance'];let tabIdx=index"
        class="offcanvas-title text-center col-6 fs-6 py-3 border-bottom pointer-class border-4 {{isActiveTab==tabIdx?'border-primary text-gray-400':'border-white text-gray-500'}} "
        (click)="isActiveTab=tabIdx"><i class="fa me-2 {{tabIdx==0 ? 'fa-cog ':'fa-sliders'}} {{isActiveTab==tabIdx?'text-primary':'text-gray-500'}} "  aria-hidden="true"></i>{{tab}}</h4>
    </div>
      <div class="offcanvas-body text-gray-400 p-0 " *ngIf="isShowComponent">
      <div class="py-3 mb-0 border-bottom border-dark border-opacity-25 border-1" *ngIf="section != null">
        <h6 class="fw-bold ms-4 mb-0">Properties</h6>
      </div>
      <form [formGroup]="PropsEditForm" class="px-4">
        <div *ngFor="let item of propList; ">
          <div [ngSwitch]="true">
            <div *ngSwitchCase="item.propType=='text' && isActiveTab==(item.propTab ? item.propTab:0) && (item.attr && item.attr.dependentOn ? getDependent(item.prop) : true)" class="py-4 field_section">
              <label [for]="item.prop" class="form-label" >{{item.propLabel | titlecase }}</label>
              <input [id]="item.prop" class="form-control rounded" type="text" [placeholder]="item.attr && item.attr.placeholder ? item.attr.placeholder:''" [formControlName]="item.prop">
              <p *ngIf="item.attr && item.attr.userGuideTxt" [innerHtml]="item.attr.userGuideTxt" class="w-100 mt-3 mb-0 bg-dark bg-opacity-10 py-2 px-3 rounded font-sm lh-base font-open-sans text-gray-400">Test:</p>
            </div>
            <div *ngSwitchCase="item.propType=='miniText' && isActiveTab==(item.propTab ? item.propTab:0) && (item.attr && item.attr.dependentOn ? getDependent(item.prop) : true)" class="d-flex flex-wrap align-items-center py-4 field_section">
              <label [for]="item.prop" class="form-label w-75 pe-2 mb-0" >{{item.propLabel | titlecase  }}</label>
              <input [id]="item.prop" class="form-control rounded w-25" type="text" [formControlName]="item.prop">
              <p *ngIf="item.attr && item.attr.userGuideTxt" [innerHtml]="item.attr.userGuideTxt" class="w-100 mt-3 mb-0 bg-dark bg-opacity-10 py-2 px-3 rounded font-sm lh-base font-open-sans text-gray-400"></p>
            </div>
            <div *ngSwitchCase="item.propType=='miniNumText' && isActiveTab==(item.propTab ? item.propTab:0) && (item.attr && item.attr.dependentOn ? getDependent(item.prop) : true)" class="d-flex justify-content-between py-4 flex-wrap field_section">
              <div class="w-75 pe-3">
                <label [for]="item.prop" class="form-label mb-0 m-2">{{item.propLabel | titlecase }}</label>
              </div>
              <div class="w-25">
                <input [id]="item.prop" class="form-control rounded" type="number" (keypress)="numberOnly($event)" (touchend)="numberOnly($event)" [formControlName]="item.prop">
              </div>
              <p *ngIf="item.attr && item.attr.userGuideTxt" [innerHtml]="item.attr.userGuideTxt" class="w-100 mt-3 mb-0 bg-dark bg-opacity-10 py-2 px-3 rounded font-sm lh-base font-open-sans text-gray-400"></p>
            </div>
            <div *ngSwitchCase="item.propType=='textarea' && isActiveTab==(item.propTab ? item.propTab:0) && (item.attr && item.attr.dependentOn ? getDependent(item.prop) : true)" class="py-4 field_section">
              <label [for]="item.prop" class="form-label" >{{item.propLabel | titlecase }}</label>
              <textarea [id]="item.prop" class="form-control rounded" cols="30" rows="4" [formControlName]="item.prop"></textarea>
              <p *ngIf="item.attr && item.attr.userGuideTxt" [innerHtml]="item.attr.userGuideTxt" class="w-100 mt-3 mb-0 bg-dark bg-opacity-10 py-2 px-3 rounded font-sm lh-base font-open-sans text-gray-400"></p>
            </div>
            <div *ngSwitchCase="item.propType=='select' && isActiveTab==(item.propTab ? item.propTab:0) && (item.attr && item.attr.dependentOn ? getDependent(item.prop) : true)" class="py-4 field_section">
              <label [for]="item.prop" class="form-label" >{{item.propLabel | titlecase }}</label>
              <select  class="form-select rounded" [formControlName]="item.prop" [id]="item.prop" >
                <option value="null" >-- select --</option>
                <option [value]="val" *ngFor="let val of [1,2,3]">{{val}}</option>
              </select>
              <p *ngIf="item.attr && item.attr.userGuideTxt" [innerHtml]="item.attr.userGuideTxt" class="w-100 mt-3 mb-0 bg-dark bg-opacity-10 py-2 px-3 rounded font-sm lh-base font-open-sans text-gray-400"></p>
            </div>
            <div *ngSwitchCase="item.propType=='checkbox' && isActiveTab==(item.propTab ? item.propTab:0) && (item.attr && item.attr.dependentOn ? getDependent(item.prop) : true)" class="py-4  field_section">
              <div class="form-check form-control-lg rounded-0 py-0 align-items-center">
                <input class="form-check-input" type="checkbox" [id]="item.prop" [formControlName]="item.prop">
                <label class="form-check-label" [for]="item.prop">{{item.propLabel | titlecase }}</label>
              </div>
              <p *ngIf="item.attr && item.attr.userGuideTxt" [innerHtml]="item.attr.userGuideTxt" class="w-100 mt-3 mb-0 bg-dark bg-opacity-10 py-2 px-3 rounded font-sm lh-base font-open-sans text-gray-400"></p>
            </div>
            <div *ngSwitchCase="item.propType=='switch' && isActiveTab==(item.propTab ? item.propTab:0) && (item.attr && item.attr.dependentOn ? getDependent(item.prop) : true)" class="py-4 pe-0 field_section form-check rounded-0 form-switch form-check-reverse form-control-lg  text-start">
              <input class="form-check-input me-0" type="checkbox" role="switch" [id]="item.prop" [formControlName]="item.prop">
              <label class="form-check-label"  [for]="item.prop" >{{item.propLabel | titlecase }}</label>
              <p *ngIf="item.attr && item.attr.userGuideTxt" [innerHtml]="item.attr.userGuideTxt" class="w-100 mt-3 mb-0 bg-dark bg-opacity-10 py-2 px-3 rounded font-sm lh-base font-open-sans text-gray-400"></p>
            </div>
            <div *ngSwitchCase="item.propType=='range' && isActiveTab==(item.propTab ? item.propTab:0) && (item.attr && item.attr.dependentOn ? getDependent(item.prop) : true)" class="field_section d-flex justify-content-between py-4 flex-wrap">
              <label [for]="item.prop" class="form-label w-100">{{item.propLabel | titlecase }}</label>
              <div class="w-75 pe-3">
                <input [id]="item.prop" type="range" class="form-range mt-2" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Tooltip on top"  min="0" max="12" step="1" [formControlName]="item.prop">
              </div>
              <div class="w-25">
                <input class="form-control rounded bg-opacity-10" style="background-color: #eeeeee85;" [id]="'rangeTxt_'+item.prop" maxlength="2" type="text" [value]="EditForm.value[item.prop]" readonly/>
              </div>
              <p *ngIf="item.attr && item.attr.userGuideTxt" [innerHtml]="item.attr.userGuideTxt" class="w-100 mt-3 mb-0 bg-dark bg-opacity-10 py-2 px-3 rounded font-sm lh-base font-open-sans text-gray-400"></p>
            </div>
            <div *ngSwitchCase="item.propType=='radioBtnPair' && isActiveTab==(item.propTab ? item.propTab:0) && (item.attr && item.attr.dependentOn ? getDependent(item.prop) : true)" class="field_section d-flex flex-wrap py-4">
              <div class="me-3">
                <input type="radio" class="btn-check" [value]="item.attr.listArr[0].id" [id]="item.attr.listArr[0].id" [formControlName]="item.prop" >
                <label class="btn btn-outline-primary rounded-pill px-5" [for]="item.attr.listArr[0].id">{{item.attr.listArr[0].value}}</label>
              </div>
              <div >
                <input type="radio" class="btn-check" [value]="item.attr.listArr[1].id" [id]="item.attr.listArr[1].id" [formControlName]="item.prop"  >
                <label class="btn btn-outline-secondary rounded-pill px-5"[for]="item.attr.listArr[1].id">{{item.attr.listArr[1].value}}</label>
              </div>
              <p *ngIf="item.attr && item.attr.userGuideTxt" [innerHtml]="item.attr.userGuideTxt" class="w-100 mt-3 mb-0 bg-dark bg-opacity-10 py-2 px-3 rounded font-sm lh-base font-open-sans text-gray-400"></p>
            </div>
            <div *ngSwitchCase="item.propType=='radioGrp' && isActiveTab==(item.propTab ? item.propTab:0) && (item.attr && item.attr.dependentOn ? getDependent(item.prop) : true)" class="field_section d-flex py-4 flex-wrap">
              <label [for]="'rdbGrp_'+item.prop" class="form-label w-100">{{item.propLabel | titlecase }}</label>
              <div class="row" *ngIf="item.attr.listArr.length>0">
                <div class="col-6"  *ngFor="let lkp of item.attr.listArr;let isOdd = odd">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" [value]="lkp.id" [id]="lkp.id" [formControlName]="item.prop" >
                    <label class="form-check-label" [for]="lkp.id">{{lkp.value}}</label>
                  </div>
                </div>
              </div>
              <p *ngIf="item.attr && item.attr.userGuideTxt" [innerHtml]="item.attr.userGuideTxt" class="w-100 mt-2 mb-0 bg-dark bg-opacity-10 py-2 px-3 rounded font-sm lh-base font-open-sans text-gray-400"></p>
            </div>
            <div *ngSwitchCase="item.propType=='optionBox' && isActiveTab==(item.propTab ? item.propTab:0) && (item.attr && item.attr.dependentOn ? getDependent(item.prop) : true)" class="py-4 field_section">
              <div class="d-flex align-items-center justify-content-between mb-2">
                <label [for]="item.prop" class="form-label" >{{item.propLabel | titlecase }} | {{EditForm.get(item.prop).length}}</label>
                <span class="badge bg-secondary font-sm pointer-class lh-1 mb-1" (click)="addNewOption(item.prop)">Add <i class="fa fa-plus ms-1" aria-hidden="true"></i></span>
              </div>
              <p *ngIf="item.attr && item.attr.userGuideTxt" [innerHtml]="item.attr.userGuideTxt" class="w-100 mb-3 mb-0 bg-dark bg-opacity-10 py-2 px-3 rounded font-sm lh-base font-open-sans text-gray-400"></p>
              <ng-container  [formArrayName]="item.prop">
                <ng-container *ngFor="let con of EditForm.get(item.prop).controls; let i=index">
                  <div class="d-flex"  [formGroupName]="i">
                    <input  class="form-control rounded mb-1" type="text" formControlName="value">
                    <button type="button" (click)="EditForm.get(item.prop).removeAt(i)" class="btn-close ms-2 mt-1" aria-label="Close"></button>
                  </div>
                </ng-container>
              </ng-container>
            </div>
            <div *ngSwitchCase="item.propType=='fileUpload' && isActiveTab==(item.propTab ? item.propTab:0) && (item.attr && item.attr.dependentOn ? getDependent(item.prop) : true)" class="py-4 field_section file_upload">
              <label [for]="item.prop" class="form-label" >{{item.propLabel | titlecase }}</label>
              <div class="px-4 py-4 rounded text-center upload_progress" >
                <div class="{{isFileUploaded(item.prop)?'d-flex w-100':'d-none'}}">
                  <img src="assets/img/file-new.svg" alt="upload-file" class="prev_img me-2">
                  <div class="text-gray-400 fw-bold right_cont">
                    <div class="d-flex justify-content-between">
                      <p class="mb-0">{{ getFileName(item.prop) }}</p>
                      <div class="ms-auto">
                        <span class="btn btn-sm btn-outline-secondary border-0" (click)="downloadFile(item.prop)"><i class="fa fa-download" aria-hidden="true" title="Download"></i></span>
                        <button type="button" (click)="removeFileUrl(item.prop)" class="ms-2 btn-close fw-bold" aria-label="Close"></button>
                      </div>
                    </div>
                    <div >
                      <hr class="w-100 my-1 border-top-2"/>
                    </div>
                    <p class="mb-0 text-start">Completed</p>
                  </div>
                </div>
                <div class="{{isFileUploaded(item.prop)?'d-none':''}}" >
                  <p class="text-center">Upload a document to sign</p>
                  <div class="btn btn-dark m-auto position-relative" >Upload document
                    <input type="file" accept=".pdf,.doc,.docx"  class="file-upld-custom" (change)="onFileChange($event, item)" >
                  </div>
                </div>
              </div>
              <p *ngIf="item.attr && item.attr.userGuideTxt" [innerHtml]="item.attr.userGuideTxt" class="w-100 mt-3 mb-0 bg-dark bg-opacity-10 py-2 px-3 rounded font-sm lh-base font-open-sans text-gray-400"></p>
            </div>
            <div *ngSwitchCase="item.propType=='DnD' && isActiveTab==(item.propTab ? item.propTab:0) && (item.attr && item.attr.dependentOn ? getDependent(item.prop) : true)" class="py-4 field_section">
              <label [for]="item.prop" class="form-label" >{{item.propLabel | titlecase }}</label>
              <p *ngIf="item.attr && item.attr.userGuideTxt" [innerHtml]="item.attr.userGuideTxt" class="w-100 mt-3 mb-0 bg-dark bg-opacity-10 py-2 px-3 rounded font-sm lh-base font-open-sans text-gray-400">Test:</p>
              <!--  -->
              <div  cdkDropList class="dnd-sidebar-list dnd-sidebar-boundary" (cdkDropListDropped)="dndOnItemDrop($event,item.prop,PropsEditForm.value[item.prop])">
                <div class="dnd-sidebar-box d-block" *ngFor="let value of PropsEditForm.value[item.prop]" cdkDragBoundary=".dnd-sidebar-boundary" cdkDrag>
                  <div class="d-flex justify-content-between ">
                    <div class="d-flex ">
                      <div class="d-flex text-secondary mt-1" ><span class="fa fa-ellipsis-v "></span><span class="fa fa-ellipsis-v" style="padding-left: 2px;"></span></div>
                      <div class="ps-2"><span>{{ value.labelName }}</span></div>
                    </div>
                    <div ><span *ngIf="value.childs && value.childs.length>0" (click)="showChildId.includes(value.formFieldId) ? showChildId.splice(showChildId.indexOf(value.formFieldId),1): showChildId.push(value.formFieldId)" style="cursor: pointer;" class="badge text-bg-primary bg-opacity-75">{{value.childs.length}}</span></div>
                  </div>
                  <div *ngIf="value.childs && value.childs.length>0 && showChildId.includes(value.formFieldId)" (cdkDropListDropped)="dndOnItemDrop($event,item.prop,value.childs)" class="d-block dnd-sidebar-list dnd-sidebar-boundary-l1  mt-3" cdkDropList>
                    <div class="dnd-sidebar-box d-block" cdkDragBoundary=".dnd-sidebar-boundary-l1" *ngFor="let val of value.childs"  cdkDrag>
                    <div class="d-flex justify-content-between ">
                      <div class="d-flex ">
                        <div class="d-flex text-secondary mt-1" ><span class="fa fa-ellipsis-v text-secondary"></span><span class="fa fa-ellipsis-v" style="padding-left: 2px;"></span></div>
                        <div class="ps-2"><span>{{ val.labelName }}</span></div>
                      </div>
                      <div ><span *ngIf="val.childs && val.childs.length>0" (click)="showChildId.includes(val.formFieldId) ? showChildId.splice(showChildId.indexOf(val.formFieldId),1): showChildId.push(val.formFieldId)" style="cursor: pointer;" class="badge text-bg-primary bg-opacity-75">{{val.childs.length}}</span></div>
                    </div>
                    <div *ngIf="val.childs && val.childs.length>0 && showChildId.includes(val.formFieldId)" (cdkDropListDropped)="dndOnItemDrop($event,item.prop,val.childs)" class="d-block dnd-sidebar-list dnd-sidebar-boundary-l2  mt-3" cdkDropList>
                      <div class="dnd-sidebar-box d-block" cdkDragBoundary=".dnd-sidebar-boundary-l2" *ngFor="let vch of val.childs"  cdkDrag>
                        <div class="d-flex justify-content-between ">
                          <div class="d-flex ">
                            <div class="d-flex text-secondary mt-1" ><span class="fa fa-ellipsis-v text-secondary"></span><span class="fa fa-ellipsis-v" style="padding-left: 2px;"></span></div>
                            <div class="ps-2"><span>{{ vch.labelName }}</span></div>
                          </div>
                        </div>
                        <div class="dnd-sidebar-custom-placeholder" *cdkDragPlaceholder></div>
                      </div>
                    </div>
                    <div class="dnd-sidebar-custom-placeholder" *cdkDragPlaceholder></div>
                    </div>
                  </div>
                  <div class="dnd-sidebar-custom-placeholder" *cdkDragPlaceholder></div>
                </div>
              </div>
              <!--  -->

            </div>

          </div>
        </div>
      </form>
    </div>
    <div class="offcanvas-footer py-3">
      <div class="d-flex justify-content-center ">
        <button class="btn btn-secondary me-2 px-lg-4 px-3" (click)="cancelChanges()">Cancel</button>
        <button class="btn btn-primary px-3 px-lg-4" [disabled]="!isSaveEnabled || PropsEditForm.invalid"  (click)="saveChanges()">Update</button>
      </div>
    </div>
</div>
